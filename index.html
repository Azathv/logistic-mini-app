<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8">
<title>Yuklar Go</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body{margin:0;padding:14px;background:#0f0f0f;color:#fff;font-family:Arial}
.header{display:flex;align-items:center;gap:10px;margin-bottom:14px}
.header img{width:40px;height:40px;border-radius:50%;background:#333}
.tabs{display:flex;gap:6px;margin-bottom:12px}
.tab{flex:1;padding:10px;text-align:center;border-radius:10px;background:#1c1c1c;cursor:pointer}
.tab.active{background:#2ea6ff}
button{width:100%;padding:16px;margin:8px 0;border:none;border-radius:14px;background:#2ea6ff;color:#fff;font-size:16px;font-weight:600}
select,input{width:100%;padding:12px;margin:6px 0;border-radius:10px;border:none;font-size:15px}
.card{background:#1c1c1c;padding:12px;border-radius:12px;margin-bottom:10px}
.hidden{display:none}

.load-card{
  background:#1c1c1c;
  padding:12px;
  border-radius:12px;
  margin-bottom:10px;
}
.load-card img{
  width:100%;
  border-radius:10px;
  margin-top:8px;
}
.location{
  font-size:12px;
  color:rgba(255,255,255,0.5);
  font-style:italic;
  margin-top:6px;
}
</style>
</head>

<body>

<div class="header">
  <img id="avatar">
  <div id="hello">Salom</div>
</div>

<div class="tabs">
  <div class="tab active" onclick="switchTab('yengil',this)">ğŸš— Yengil</div>
  <div class="tab" onclick="switchTab('orta',this)">ğŸš Oâ€˜rta</div>
  <div class="tab" onclick="switchTab('ogir',this)">ğŸšš Ogâ€˜ir</div>
</div>

<div id="home">
  <button onclick="openAdd()">â• Yuk joylash</button>
</div>

<div id="add" class="hidden">

  <select id="category">
    <option value="yengil">ğŸš— Yengil</option>
    <option value="orta">ğŸš Oâ€˜rta</option>
    <option value="ogir">ğŸšš Ogâ€˜ir</option>
  </select>

  <div class="card">
    <b>ğŸ“ Qayerdan</b>
    <select id="fromRegion"></select>
    <select id="fromDistrict"></select>
  </div>

  <div class="card">
    <b>ğŸ¯ Qayerga</b>
    <select id="toRegion"></select>
    <select id="toDistrict"></select>
  </div>

  <input id="weight" placeholder="Yuk (masalan: 3 tonna)">
  <input type="file" id="image" accept="image/*">
  <input id="contact" placeholder="Telegram yoki telefon">

  <button onclick="save()">Saqlash</button>
  <button onclick="back()">â† Orqaga</button>
</div>

<div id="list"></div>

<script>
// TELEGRAM USER
if(window.Telegram?.WebApp){
  Telegram.WebApp.expand();
  const u=Telegram.WebApp.initDataUnsafe.user;
  if(u){
    hello.innerText="Salom, "+u.first_name;
    if(u.photo_url) avatar.src=u.photo_url;
    if(u.username) contact.value="@"+u.username;
  }
}

// HUDUDLAR (QISQA QOLDIRILDI â€“ SENDA BOR)
const regions={"Toshkent shahri":["Yunusobod","Chilonzor","Mirzo Ulugâ€˜bek"]};

function init(){
["from","to"].forEach(t=>{
  const r=document.getElementById(t+"Region");
  const d=document.getElementById(t+"District");
  r.innerHTML=Object.keys(regions).map(v=>`<option>${v}</option>`).join("");
  r.onchange=()=>d.innerHTML=regions[r.value].map(x=>`<option>${x}</option>`).join("");
  r.onchange();
});
}
init();

function openAdd(){home.classList.add("hidden");add.classList.remove("hidden")}
function back(){add.classList.add("hidden");home.classList.remove("hidden")}

// ====== CATEGORY LOGIC ======
let activeCategory="yengil";

function switchTab(cat,el){
  activeCategory=cat;
  document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
  el.classList.add("active");
  render();
}

// ====== SAQLASH ======
function save(){
  const data={
    category: category.value,
    from: fromRegion.value+" / "+fromDistrict.value,
    to: toRegion.value+" / "+toDistrict.value,
    weight: weight.value,
    contact: contact.value,
    image: null
  };

  const file=image.files[0];
  if(file){
    const reader=new FileReader();
    reader.onload=()=>{
      data.image=reader.result;
      pushData(data);
    };
    reader.readAsDataURL(file);
  }else{
    pushData(data);
  }
}

function pushData(data){
  const arr=JSON.parse(localStorage.getItem("loads")||"[]");
  arr.unshift(data);
  localStorage.setItem("loads",JSON.stringify(arr));
  render();
  back();
}

// ====== CHIQARISH ======
function render(){
  const arr=JSON.parse(localStorage.getItem("loads")||"[]");
  list.innerHTML="";
  arr.filter(l=>l.category===activeCategory).forEach(l=>{
    list.innerHTML+=`
      <div class="load-card">
        <b>${l.weight||"Yuk"}</b>
        <div class="location">ğŸ“ ${l.from} â†’ ${l.to}</div>
        ${l.image?`<img src="${l.image}">`:""}
      </div>`;
  });
}

render();
</script>

</body>
</html>
