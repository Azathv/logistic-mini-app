<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8">
<title>Yuklar Go</title>
<style>
body{margin:0;padding:14px;background:#0f0f0f;color:#fff;font-family:Arial;font-size:16px;}
.header{display:flex;align-items:center;gap:10px;margin-bottom:14px}
.header img{width:50px;height:50px;border-radius:50%;background:#333;}
button{width:100%;padding:18px;margin:10px 0;border:none;border-radius:16px;background:#2ea6ff;color:#fff;font-size:18px;font-weight:600;cursor:pointer}
select,input{width:100%;padding:16px;margin:8px 0;border-radius:14px;border:none;font-size:17px;font-style:normal;}
.card{background:#1c1c1c;padding:16px;border-radius:14px;margin-bottom:12px}
.load-card{background:#1c1c1c;padding:16px;border-radius:14px;margin-bottom:12px}
.location{font-size:14px;color:rgba(255,255,255,0.6);margin-top:4px}
.date{font-size:12px;color:rgba(255,255,255,0.4);margin-top:4px}
.hidden{display:none}
#home{margin-bottom:10px}
.tabs{display:flex;gap:8px;margin-bottom:20px;}
.tab{flex:1;padding:14px;text-align:center;border-radius:12px;background:#1c1c1c;cursor:pointer;font-size:18px}
.tab.active{background:#2ea6ff}
#list{margin-bottom:50px}

@media(max-width:600px){
  body{font-size:18px;}
  button{padding:22px;font-size:20px;}
  select,input{padding:18px;font-size:18px;}
  .tab{padding:16px;font-size:20px;}
  .header img{width:60px;height:60px;}
}
</style>
</head>

<body>

<div class="header">
  <img id="avatar">
  <div id="hello">Salom</div>
</div>

<div id="home">
  <button onclick="openAdd()">â• Yuk joylash</button>
  <div class="tabs">
    <div class="tab active" onclick="switchTab('yengil',this)">ğŸš— Yengil</div>
    <div class="tab" onclick="switchTab('orta',this)">ğŸš Oâ€˜rta</div>
    <div class="tab" onclick="switchTab('ogir',this)">ğŸšš Ogâ€˜ir</div>
  </div>

  <!-- Viloyat bo'yicha filter -->
  <select id="filterRegion" onchange="render()">
    <option value="">ğŸ“ Viloyat bo'yicha filtr</option>
  </select>
</div>

<div id="add" class="hidden">
  <select id="category">
    <option value="yengil">ğŸš— Yengil</option>
    <option value="orta">ğŸš Oâ€˜rta</option>
    <option value="ogir">ğŸšš Ogâ€˜ir</option>
  </select>

  <div class="card">
    <b>ğŸ“ Qayerdan</b>
    <select id="fromRegion"></select>
    <select id="fromDistrict"></select>
  </div>

  <div class="card">
    <b>ğŸ¯ Qayerga</b>
    <select id="toRegion"></select>
    <select id="toDistrict"></select>
  </div>

  <input id="weight" placeholder="Yukingiz nomi va qanchaligini yozing">
  <input id="contact" placeholder="Telegram yoki telefon">

  <button onclick="save()">Saqlash</button>
  <button onclick="back()">â† Orqaga</button>
</div>

<div id="list"></div>

<script>
// TELEGRAM USER
if(window.Telegram?.WebApp){
  Telegram.WebApp.expand();
  const u=Telegram.WebApp.initDataUnsafe.user;
  if(u){
    hello.innerText="Salom, "+u.first_name;
    if(u.photo_url) avatar.src=u.photo_url;
    if(u.username) contact.value="@"+u.username;
  }
}

// HUDUDLAR
const regions={
  "Toshkent shahri":["Yunusobod","Chilonzor","Mirzo Ulugâ€˜bek"],
  "Andijon":["Andijon shahar","Asaka","Baliqchi"],
  "Fargâ€˜ona":["Fargâ€˜ona shahar","Beshariq","Oltiariq"]
};

// INIT SELECTS
function init(){
  ["from","to"].forEach(t=>{
    const r=document.getElementById(t+"Region");
    const d=document.getElementById(t+"District");
    r.innerHTML=Object.keys(regions).map(v=>`<option value="${v}">${v}</option>`).join("");
    r.onchange=()=>{
      const selectedFull = r.value;
      d.innerHTML=regions[selectedFull].map(x=>`<option>${x}</option>`).join("");
    };
    r.onchange();
  });

  // Filter selectni to'ldirish
  const filter=document.getElementById("filterRegion");
  filter.innerHTML='<option value="">ğŸ“ Viloyat bo\'yicha filtr</option>';
  Object.keys(regions).forEach(v=>{
    filter.innerHTML+=`<option value="${v}">${v}</option>`;
  });
}
init();

function openAdd(){home.classList.add("hidden");add.classList.remove("hidden")}
function back(){add.classList.add("hidden");home.classList.remove("hidden")}

// CATEGORY
let activeCategory="yengil";
function switchTab(cat,el){
  activeCategory=cat;
  document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
  el.classList.add("active");
  render();
}

// SAVE
function save(){
  const data={
    category: category.value,
    from: fromRegion.value.slice(0,3)+" / "+fromDistrict.value,
    to: toRegion.value.slice(0,3)+" / "+toDistrict.value,
    weight: weight.value,
    contact: contact.value,
    date: new Date().toLocaleString()
  };
  const arr=JSON.parse(localStorage.getItem("loads")||"[]");
  arr.unshift(data);
  localStorage.setItem("loads",JSON.stringify(arr));
  render();
  back();
}

// RENDER
function render(){
  const arr=JSON.parse(localStorage.getItem("loads")||"[]");
  const filterRegion = document.getElementById("filterRegion").value;
  list.innerHTML="";
  arr.filter(l=>{
    return l.category===activeCategory &&
           (filterRegion==="" || l.from.startsWith(filterRegion.slice(0,3)));
  }).forEach(l=>{
    let contactHTML = l.contact;
    // agar @ bilan telegram username bo'lsa linkga aylantirish
    if(contactHTML && contactHTML.startsWith("@")){
      const username = contactHTML.replace("@","");
      contactHTML = `<a href="https://t.me/${username}" target="_blank" style="color:#2ea6ff;text-decoration:none;">${l.contact}</a>`;
    }
    list.innerHTML+=`
      <div class="load-card">
        <div>
          <b>${l.weight||"Yuk"}</b>
          <div class="location">ğŸ“ ${l.from} â†’ ${l.to}</div>
          <div class="location">ğŸ“ ${contactHTML||""}</div>
          <div class="date">ğŸ•’ ${l.date}</div>
        </div>
      </div>`;
  });
}

render();
</script>

</body>
</html>
